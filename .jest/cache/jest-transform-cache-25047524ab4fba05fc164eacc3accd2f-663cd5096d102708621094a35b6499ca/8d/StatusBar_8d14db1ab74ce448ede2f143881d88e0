2c7fc99a9827e63fdd8ebd660ee2548c
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _NativeStatusBarManager = _interopRequireDefault(require("./NativeStatusBarManager"));

var _NativeStatusBarManag;

var Platform = require('../../Utilities/Platform');

var React = require('react');

var processColor = require('../../StyleSheet/processColor');

function mergePropsStack(propsStack, defaultValues) {
  return propsStack.reduce(function (prev, cur) {
    for (var prop in cur) {
      if (cur[prop] != null) {
        prev[prop] = cur[prop];
      }
    }

    return prev;
  }, (0, _extends2.default)({}, defaultValues));
}

function createStackEntry(props) {
  return {
    backgroundColor: props.backgroundColor != null ? {
      value: props.backgroundColor,
      animated: props.animated
    } : null,
    barStyle: props.barStyle != null ? {
      value: props.barStyle,
      animated: props.animated
    } : null,
    translucent: props.translucent,
    hidden: props.hidden != null ? {
      value: props.hidden,
      animated: props.animated,
      transition: props.showHideTransition
    } : null,
    networkActivityIndicatorVisible: props.networkActivityIndicatorVisible
  };
}

var StatusBar = function (_React$Component) {
  (0, _inherits2.default)(StatusBar, _React$Component);

  function StatusBar() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2.default)(this, StatusBar);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(StatusBar)).call.apply(_getPrototypeOf2, [this].concat(args)));
    _this._stackEntry = null;
    return _this;
  }

  (0, _createClass2.default)(StatusBar, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._stackEntry = StatusBar.pushStackEntry(this.props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      StatusBar.popStackEntry(this._stackEntry);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this._stackEntry = StatusBar.replaceStackEntry(this._stackEntry, this.props);
    }
  }, {
    key: "render",
    value: function render() {
      return null;
    }
  }], [{
    key: "setHidden",
    value: function setHidden(hidden, animation) {
      animation = animation || 'none';
      StatusBar._defaultProps.hidden.value = hidden;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManager.default.setHidden(hidden, animation);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManager.default.setHidden(hidden);
      }
    }
  }, {
    key: "setBarStyle",
    value: function setBarStyle(style, animated) {
      animated = animated || false;
      StatusBar._defaultProps.barStyle.value = style;

      if (Platform.OS === 'ios') {
        _NativeStatusBarManager.default.setStyle(style, animated);
      } else if (Platform.OS === 'android') {
        _NativeStatusBarManager.default.setStyle(style);
      }
    }
  }, {
    key: "setNetworkActivityIndicatorVisible",
    value: function setNetworkActivityIndicatorVisible(visible) {
      if (Platform.OS !== 'ios') {
        console.warn('`setNetworkActivityIndicatorVisible` is only available on iOS');
        return;
      }

      StatusBar._defaultProps.networkActivityIndicatorVisible = visible;

      _NativeStatusBarManager.default.setNetworkActivityIndicatorVisible(visible);
    }
  }, {
    key: "setBackgroundColor",
    value: function setBackgroundColor(color, animated) {
      if (Platform.OS !== 'android') {
        console.warn('`setBackgroundColor` is only available on Android');
        return;
      }

      animated = animated || false;
      StatusBar._defaultProps.backgroundColor.value = color;
      var processedColor = processColor(color);

      if (processedColor == null) {
        console.warn("`StatusBar.setBackgroundColor`: Color " + color + " parsed to null or undefined");
        return;
      }

      _NativeStatusBarManager.default.setColor(processedColor, animated);
    }
  }, {
    key: "setTranslucent",
    value: function setTranslucent(translucent) {
      if (Platform.OS !== 'android') {
        console.warn('`setTranslucent` is only available on Android');
        return;
      }

      StatusBar._defaultProps.translucent = translucent;

      _NativeStatusBarManager.default.setTranslucent(translucent);
    }
  }, {
    key: "pushStackEntry",
    value: function pushStackEntry(props) {
      var entry = createStackEntry(props);

      StatusBar._propsStack.push(entry);

      StatusBar._updatePropsStack();

      return entry;
    }
  }, {
    key: "popStackEntry",
    value: function popStackEntry(entry) {
      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack.splice(index, 1);
      }

      StatusBar._updatePropsStack();
    }
  }, {
    key: "replaceStackEntry",
    value: function replaceStackEntry(entry, props) {
      var newEntry = createStackEntry(props);

      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack[index] = newEntry;
      }

      StatusBar._updatePropsStack();

      return newEntry;
    }
  }]);
  return StatusBar;
}(React.Component);

StatusBar._propsStack = [];
StatusBar._defaultProps = createStackEntry({
  animated: false,
  showHideTransition: 'fade',
  backgroundColor: Platform.select({
    android: (_NativeStatusBarManag = _NativeStatusBarManager.default.getConstants().DEFAULT_BACKGROUND_COLOR) != null ? _NativeStatusBarManag : 'black',
    ios: 'black'
  }),
  barStyle: 'default',
  translucent: false,
  hidden: false,
  networkActivityIndicatorVisible: false
});
StatusBar._updateImmediate = null;
StatusBar._currentValues = null;
StatusBar.currentHeight = _NativeStatusBarManager.default.getConstants().HEIGHT;
StatusBar.defaultProps = {
  animated: false,
  showHideTransition: 'fade'
};

StatusBar._updatePropsStack = function () {
  clearImmediate(StatusBar._updateImmediate);
  StatusBar._updateImmediate = setImmediate(function () {
    var oldProps = StatusBar._currentValues;
    var mergedProps = mergePropsStack(StatusBar._propsStack, StatusBar._defaultProps);

    if (Platform.OS === 'ios') {
      if (!oldProps || oldProps.barStyle.value !== mergedProps.barStyle.value) {
        _NativeStatusBarManager.default.setStyle(mergedProps.barStyle.value, mergedProps.barStyle.animated || false);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManager.default.setHidden(mergedProps.hidden.value, mergedProps.hidden.animated ? mergedProps.hidden.transition : 'none');
      }

      if (!oldProps || oldProps.networkActivityIndicatorVisible !== mergedProps.networkActivityIndicatorVisible) {
        _NativeStatusBarManager.default.setNetworkActivityIndicatorVisible(mergedProps.networkActivityIndicatorVisible);
      }
    } else if (Platform.OS === 'android') {
      if (!oldProps || oldProps.barStyle.value !== mergedProps.barStyle.value) {
        _NativeStatusBarManager.default.setStyle(mergedProps.barStyle.value);
      }

      if (!oldProps || oldProps.backgroundColor.value !== mergedProps.backgroundColor.value) {
        var processedColor = processColor(mergedProps.backgroundColor.value);

        if (processedColor == null) {
          console.warn("`StatusBar._updatePropsStack`: Color " + mergedProps.backgroundColor.value + " parsed to null or undefined");
        } else {
          _NativeStatusBarManager.default.setColor(processedColor, mergedProps.backgroundColor.animated);
        }
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        _NativeStatusBarManager.default.setHidden(mergedProps.hidden.value);
      }

      if (!oldProps || oldProps.translucent !== mergedProps.translucent) {
        _NativeStatusBarManager.default.setTranslucent(mergedProps.translucent);
      }
    }

    StatusBar._currentValues = mergedProps;
  });
};

module.exports = StatusBar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YXR1c0Jhci5qcyJdLCJuYW1lcyI6WyJQbGF0Zm9ybSIsInJlcXVpcmUiLCJSZWFjdCIsInByb2Nlc3NDb2xvciIsIm1lcmdlUHJvcHNTdGFjayIsInByb3BzU3RhY2siLCJkZWZhdWx0VmFsdWVzIiwicmVkdWNlIiwicHJldiIsImN1ciIsInByb3AiLCJjcmVhdGVTdGFja0VudHJ5IiwicHJvcHMiLCJiYWNrZ3JvdW5kQ29sb3IiLCJ2YWx1ZSIsImFuaW1hdGVkIiwiYmFyU3R5bGUiLCJ0cmFuc2x1Y2VudCIsImhpZGRlbiIsInRyYW5zaXRpb24iLCJzaG93SGlkZVRyYW5zaXRpb24iLCJuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlIiwiU3RhdHVzQmFyIiwiX3N0YWNrRW50cnkiLCJwdXNoU3RhY2tFbnRyeSIsInBvcFN0YWNrRW50cnkiLCJyZXBsYWNlU3RhY2tFbnRyeSIsImFuaW1hdGlvbiIsIl9kZWZhdWx0UHJvcHMiLCJPUyIsIk5hdGl2ZVN0YXR1c0Jhck1hbmFnZXIiLCJzZXRIaWRkZW4iLCJzdHlsZSIsInNldFN0eWxlIiwidmlzaWJsZSIsImNvbnNvbGUiLCJ3YXJuIiwic2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSIsImNvbG9yIiwicHJvY2Vzc2VkQ29sb3IiLCJzZXRDb2xvciIsInNldFRyYW5zbHVjZW50IiwiZW50cnkiLCJfcHJvcHNTdGFjayIsInB1c2giLCJfdXBkYXRlUHJvcHNTdGFjayIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsIm5ld0VudHJ5IiwiQ29tcG9uZW50Iiwic2VsZWN0IiwiYW5kcm9pZCIsImdldENvbnN0YW50cyIsIkRFRkFVTFRfQkFDS0dST1VORF9DT0xPUiIsImlvcyIsIl91cGRhdGVJbW1lZGlhdGUiLCJfY3VycmVudFZhbHVlcyIsImN1cnJlbnRIZWlnaHQiLCJIRUlHSFQiLCJkZWZhdWx0UHJvcHMiLCJjbGVhckltbWVkaWF0ZSIsInNldEltbWVkaWF0ZSIsIm9sZFByb3BzIiwibWVyZ2VkUHJvcHMiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFVQTs7Ozs7Ozs7Ozs7Ozs7OztBQU9BOzs7O0FBTEEsSUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsMEJBQUQsQ0FBeEI7O0FBQ0EsSUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFFQSxJQUFNRSxZQUFZLEdBQUdGLE9BQU8sQ0FBQywrQkFBRCxDQUE1Qjs7QUE2RkEsU0FBU0csZUFBVCxDQUNFQyxVQURGLEVBRUVDLGFBRkYsRUFHVTtBQUNSLFNBQU9ELFVBQVUsQ0FBQ0UsTUFBWCxDQUFrQixVQUFDQyxJQUFELEVBQU9DLEdBQVAsRUFBZTtBQUN0QyxTQUFLLElBQU1DLElBQVgsSUFBbUJELEdBQW5CLEVBQXdCO0FBQ3RCLFVBQUlBLEdBQUcsQ0FBQ0MsSUFBRCxDQUFILElBQWEsSUFBakIsRUFBdUI7QUFDckJGLFFBQUFBLElBQUksQ0FBQ0UsSUFBRCxDQUFKLEdBQWFELEdBQUcsQ0FBQ0MsSUFBRCxDQUFoQjtBQUNEO0FBQ0Y7O0FBQ0QsV0FBT0YsSUFBUDtBQUNELEdBUE0sRUFPSix1QkFBYyxFQUFkLEVBQWtCRixhQUFsQixDQVBJLENBQVA7QUFRRDs7QUFNRCxTQUFTSyxnQkFBVCxDQUEwQkMsS0FBMUIsRUFBMkM7QUFDekMsU0FBTztBQUNMQyxJQUFBQSxlQUFlLEVBQ2JELEtBQUssQ0FBQ0MsZUFBTixJQUF5QixJQUF6QixHQUNJO0FBQ0VDLE1BQUFBLEtBQUssRUFBRUYsS0FBSyxDQUFDQyxlQURmO0FBRUVFLE1BQUFBLFFBQVEsRUFBRUgsS0FBSyxDQUFDRztBQUZsQixLQURKLEdBS0ksSUFQRDtBQVFMQyxJQUFBQSxRQUFRLEVBQ05KLEtBQUssQ0FBQ0ksUUFBTixJQUFrQixJQUFsQixHQUNJO0FBQ0VGLE1BQUFBLEtBQUssRUFBRUYsS0FBSyxDQUFDSSxRQURmO0FBRUVELE1BQUFBLFFBQVEsRUFBRUgsS0FBSyxDQUFDRztBQUZsQixLQURKLEdBS0ksSUFkRDtBQWVMRSxJQUFBQSxXQUFXLEVBQUVMLEtBQUssQ0FBQ0ssV0FmZDtBQWdCTEMsSUFBQUEsTUFBTSxFQUNKTixLQUFLLENBQUNNLE1BQU4sSUFBZ0IsSUFBaEIsR0FDSTtBQUNFSixNQUFBQSxLQUFLLEVBQUVGLEtBQUssQ0FBQ00sTUFEZjtBQUVFSCxNQUFBQSxRQUFRLEVBQUVILEtBQUssQ0FBQ0csUUFGbEI7QUFHRUksTUFBQUEsVUFBVSxFQUFFUCxLQUFLLENBQUNRO0FBSHBCLEtBREosR0FNSSxJQXZCRDtBQXdCTEMsSUFBQUEsK0JBQStCLEVBQUVULEtBQUssQ0FBQ1M7QUF4QmxDLEdBQVA7QUEwQkQ7O0lBZ0VLQyxTOzs7Ozs7Ozs7Ozs7Ozs7VUF5S0pDLFcsR0FBYyxJOzs7Ozs7d0NBRU07QUFLbEIsV0FBS0EsV0FBTCxHQUFtQkQsU0FBUyxDQUFDRSxjQUFWLENBQXlCLEtBQUtaLEtBQTlCLENBQW5CO0FBQ0Q7OzsyQ0FFc0I7QUFHckJVLE1BQUFBLFNBQVMsQ0FBQ0csYUFBVixDQUF3QixLQUFLRixXQUE3QjtBQUNEOzs7eUNBRW9CO0FBQ25CLFdBQUtBLFdBQUwsR0FBbUJELFNBQVMsQ0FBQ0ksaUJBQVYsQ0FDakIsS0FBS0gsV0FEWSxFQUVqQixLQUFLWCxLQUZZLENBQW5CO0FBSUQ7Ozs2QkFtRm9CO0FBQ25CLGFBQU8sSUFBUDtBQUNEOzs7OEJBek9nQk0sTSxFQUFpQlMsUyxFQUFnQztBQUNoRUEsTUFBQUEsU0FBUyxHQUFHQSxTQUFTLElBQUksTUFBekI7QUFDQUwsTUFBQUEsU0FBUyxDQUFDTSxhQUFWLENBQXdCVixNQUF4QixDQUErQkosS0FBL0IsR0FBdUNJLE1BQXZDOztBQUNBLFVBQUlsQixRQUFRLENBQUM2QixFQUFULEtBQWdCLEtBQXBCLEVBQTJCO0FBQ3pCQyx3Q0FBdUJDLFNBQXZCLENBQWlDYixNQUFqQyxFQUF5Q1MsU0FBekM7QUFDRCxPQUZELE1BRU8sSUFBSTNCLFFBQVEsQ0FBQzZCLEVBQVQsS0FBZ0IsU0FBcEIsRUFBK0I7QUFDcENDLHdDQUF1QkMsU0FBdkIsQ0FBaUNiLE1BQWpDO0FBQ0Q7QUFDRjs7O2dDQU9rQmMsSyxFQUF1QmpCLFEsRUFBb0I7QUFDNURBLE1BQUFBLFFBQVEsR0FBR0EsUUFBUSxJQUFJLEtBQXZCO0FBQ0FPLE1BQUFBLFNBQVMsQ0FBQ00sYUFBVixDQUF3QlosUUFBeEIsQ0FBaUNGLEtBQWpDLEdBQXlDa0IsS0FBekM7O0FBQ0EsVUFBSWhDLFFBQVEsQ0FBQzZCLEVBQVQsS0FBZ0IsS0FBcEIsRUFBMkI7QUFDekJDLHdDQUF1QkcsUUFBdkIsQ0FBZ0NELEtBQWhDLEVBQXVDakIsUUFBdkM7QUFDRCxPQUZELE1BRU8sSUFBSWYsUUFBUSxDQUFDNkIsRUFBVCxLQUFnQixTQUFwQixFQUErQjtBQUNwQ0Msd0NBQXVCRyxRQUF2QixDQUFnQ0QsS0FBaEM7QUFDRDtBQUNGOzs7dURBTXlDRSxPLEVBQWtCO0FBQzFELFVBQUlsQyxRQUFRLENBQUM2QixFQUFULEtBQWdCLEtBQXBCLEVBQTJCO0FBQ3pCTSxRQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FDRSwrREFERjtBQUdBO0FBQ0Q7O0FBQ0RkLE1BQUFBLFNBQVMsQ0FBQ00sYUFBVixDQUF3QlAsK0JBQXhCLEdBQTBEYSxPQUExRDs7QUFDQUosc0NBQXVCTyxrQ0FBdkIsQ0FBMERILE9BQTFEO0FBQ0Q7Ozt1Q0FPeUJJLEssRUFBZXZCLFEsRUFBb0I7QUFDM0QsVUFBSWYsUUFBUSxDQUFDNkIsRUFBVCxLQUFnQixTQUFwQixFQUErQjtBQUM3Qk0sUUFBQUEsT0FBTyxDQUFDQyxJQUFSLENBQWEsbURBQWI7QUFDQTtBQUNEOztBQUNEckIsTUFBQUEsUUFBUSxHQUFHQSxRQUFRLElBQUksS0FBdkI7QUFDQU8sTUFBQUEsU0FBUyxDQUFDTSxhQUFWLENBQXdCZixlQUF4QixDQUF3Q0MsS0FBeEMsR0FBZ0R3QixLQUFoRDtBQUVBLFVBQU1DLGNBQWMsR0FBR3BDLFlBQVksQ0FBQ21DLEtBQUQsQ0FBbkM7O0FBQ0EsVUFBSUMsY0FBYyxJQUFJLElBQXRCLEVBQTRCO0FBQzFCSixRQUFBQSxPQUFPLENBQUNDLElBQVIsNENBQzZDRSxLQUQ3QztBQUdBO0FBQ0Q7O0FBRURSLHNDQUF1QlUsUUFBdkIsQ0FBZ0NELGNBQWhDLEVBQWdEeEIsUUFBaEQ7QUFDRDs7O21DQU1xQkUsVyxFQUFzQjtBQUMxQyxVQUFJakIsUUFBUSxDQUFDNkIsRUFBVCxLQUFnQixTQUFwQixFQUErQjtBQUM3Qk0sUUFBQUEsT0FBTyxDQUFDQyxJQUFSLENBQWEsK0NBQWI7QUFDQTtBQUNEOztBQUNEZCxNQUFBQSxTQUFTLENBQUNNLGFBQVYsQ0FBd0JYLFdBQXhCLEdBQXNDQSxXQUF0Qzs7QUFDQWEsc0NBQXVCVyxjQUF2QixDQUFzQ3hCLFdBQXRDO0FBQ0Q7OzttQ0FRcUJMLEssRUFBaUI7QUFDckMsVUFBTThCLEtBQUssR0FBRy9CLGdCQUFnQixDQUFDQyxLQUFELENBQTlCOztBQUNBVSxNQUFBQSxTQUFTLENBQUNxQixXQUFWLENBQXNCQyxJQUF0QixDQUEyQkYsS0FBM0I7O0FBQ0FwQixNQUFBQSxTQUFTLENBQUN1QixpQkFBVjs7QUFDQSxhQUFPSCxLQUFQO0FBQ0Q7OztrQ0FPb0JBLEssRUFBWTtBQUMvQixVQUFNSSxLQUFLLEdBQUd4QixTQUFTLENBQUNxQixXQUFWLENBQXNCSSxPQUF0QixDQUE4QkwsS0FBOUIsQ0FBZDs7QUFDQSxVQUFJSSxLQUFLLEtBQUssQ0FBQyxDQUFmLEVBQWtCO0FBQ2hCeEIsUUFBQUEsU0FBUyxDQUFDcUIsV0FBVixDQUFzQkssTUFBdEIsQ0FBNkJGLEtBQTdCLEVBQW9DLENBQXBDO0FBQ0Q7O0FBQ0R4QixNQUFBQSxTQUFTLENBQUN1QixpQkFBVjtBQUNEOzs7c0NBUXdCSCxLLEVBQVk5QixLLEVBQWlCO0FBQ3BELFVBQU1xQyxRQUFRLEdBQUd0QyxnQkFBZ0IsQ0FBQ0MsS0FBRCxDQUFqQzs7QUFDQSxVQUFNa0MsS0FBSyxHQUFHeEIsU0FBUyxDQUFDcUIsV0FBVixDQUFzQkksT0FBdEIsQ0FBOEJMLEtBQTlCLENBQWQ7O0FBQ0EsVUFBSUksS0FBSyxLQUFLLENBQUMsQ0FBZixFQUFrQjtBQUNoQnhCLFFBQUFBLFNBQVMsQ0FBQ3FCLFdBQVYsQ0FBc0JHLEtBQXRCLElBQStCRyxRQUEvQjtBQUNEOztBQUNEM0IsTUFBQUEsU0FBUyxDQUFDdUIsaUJBQVY7O0FBQ0EsYUFBT0ksUUFBUDtBQUNEOzs7RUEvSnFCL0MsS0FBSyxDQUFDZ0QsUzs7QUFBeEI1QixTLENBQ0dxQixXLEdBQWMsRTtBQURqQnJCLFMsQ0FHR00sYSxHQUFnQmpCLGdCQUFnQixDQUFDO0FBQ3RDSSxFQUFBQSxRQUFRLEVBQUUsS0FENEI7QUFFdENLLEVBQUFBLGtCQUFrQixFQUFFLE1BRmtCO0FBR3RDUCxFQUFBQSxlQUFlLEVBQUViLFFBQVEsQ0FBQ21ELE1BQVQsQ0FBZ0I7QUFDL0JDLElBQUFBLE9BQU8sMkJBQ0x0QixnQ0FBdUJ1QixZQUF2QixHQUFzQ0Msd0JBRGpDLG9DQUVMLE9BSDZCO0FBSS9CQyxJQUFBQSxHQUFHLEVBQUU7QUFKMEIsR0FBaEIsQ0FIcUI7QUFTdEN2QyxFQUFBQSxRQUFRLEVBQUUsU0FUNEI7QUFVdENDLEVBQUFBLFdBQVcsRUFBRSxLQVZ5QjtBQVd0Q0MsRUFBQUEsTUFBTSxFQUFFLEtBWDhCO0FBWXRDRyxFQUFBQSwrQkFBK0IsRUFBRTtBQVpLLENBQUQsQztBQUhuQ0MsUyxDQW1CR2tDLGdCLEdBQW1CLEk7QUFuQnRCbEMsUyxDQXNCR21DLGMsR0FBaUIsSTtBQXRCcEJuQyxTLENBK0JHb0MsYSxHQUF3QjVCLGdDQUF1QnVCLFlBQXZCLEdBQXNDTSxNO0FBL0JqRXJDLFMsQ0FpS0dzQyxZLEdBR0Q7QUFDSjdDLEVBQUFBLFFBQVEsRUFBRSxLQUROO0FBRUpLLEVBQUFBLGtCQUFrQixFQUFFO0FBRmhCLEM7O0FBcEtGRSxTLENBbU1HdUIsaUIsR0FBb0IsWUFBTTtBQUUvQmdCLEVBQUFBLGNBQWMsQ0FBQ3ZDLFNBQVMsQ0FBQ2tDLGdCQUFYLENBQWQ7QUFDQWxDLEVBQUFBLFNBQVMsQ0FBQ2tDLGdCQUFWLEdBQTZCTSxZQUFZLENBQUMsWUFBTTtBQUM5QyxRQUFNQyxRQUFRLEdBQUd6QyxTQUFTLENBQUNtQyxjQUEzQjtBQUNBLFFBQU1PLFdBQVcsR0FBRzVELGVBQWUsQ0FDakNrQixTQUFTLENBQUNxQixXQUR1QixFQUVqQ3JCLFNBQVMsQ0FBQ00sYUFGdUIsQ0FBbkM7O0FBTUEsUUFBSTVCLFFBQVEsQ0FBQzZCLEVBQVQsS0FBZ0IsS0FBcEIsRUFBMkI7QUFDekIsVUFDRSxDQUFDa0MsUUFBRCxJQUNBQSxRQUFRLENBQUMvQyxRQUFULENBQWtCRixLQUFsQixLQUE0QmtELFdBQVcsQ0FBQ2hELFFBQVosQ0FBcUJGLEtBRm5ELEVBR0U7QUFDQWdCLHdDQUF1QkcsUUFBdkIsQ0FDRStCLFdBQVcsQ0FBQ2hELFFBQVosQ0FBcUJGLEtBRHZCLEVBRUVrRCxXQUFXLENBQUNoRCxRQUFaLENBQXFCRCxRQUFyQixJQUFpQyxLQUZuQztBQUlEOztBQUNELFVBQUksQ0FBQ2dELFFBQUQsSUFBYUEsUUFBUSxDQUFDN0MsTUFBVCxDQUFnQkosS0FBaEIsS0FBMEJrRCxXQUFXLENBQUM5QyxNQUFaLENBQW1CSixLQUE5RCxFQUFxRTtBQUNuRWdCLHdDQUF1QkMsU0FBdkIsQ0FDRWlDLFdBQVcsQ0FBQzlDLE1BQVosQ0FBbUJKLEtBRHJCLEVBRUVrRCxXQUFXLENBQUM5QyxNQUFaLENBQW1CSCxRQUFuQixHQUNJaUQsV0FBVyxDQUFDOUMsTUFBWixDQUFtQkMsVUFEdkIsR0FFSSxNQUpOO0FBTUQ7O0FBRUQsVUFDRSxDQUFDNEMsUUFBRCxJQUNBQSxRQUFRLENBQUMxQywrQkFBVCxLQUNFMkMsV0FBVyxDQUFDM0MsK0JBSGhCLEVBSUU7QUFDQVMsd0NBQXVCTyxrQ0FBdkIsQ0FDRTJCLFdBQVcsQ0FBQzNDLCtCQURkO0FBR0Q7QUFDRixLQTVCRCxNQTRCTyxJQUFJckIsUUFBUSxDQUFDNkIsRUFBVCxLQUFnQixTQUFwQixFQUErQjtBQUNwQyxVQUNFLENBQUNrQyxRQUFELElBQ0FBLFFBQVEsQ0FBQy9DLFFBQVQsQ0FBa0JGLEtBQWxCLEtBQTRCa0QsV0FBVyxDQUFDaEQsUUFBWixDQUFxQkYsS0FGbkQsRUFHRTtBQUNBZ0Isd0NBQXVCRyxRQUF2QixDQUFnQytCLFdBQVcsQ0FBQ2hELFFBQVosQ0FBcUJGLEtBQXJEO0FBQ0Q7O0FBQ0QsVUFDRSxDQUFDaUQsUUFBRCxJQUNBQSxRQUFRLENBQUNsRCxlQUFULENBQXlCQyxLQUF6QixLQUFtQ2tELFdBQVcsQ0FBQ25ELGVBQVosQ0FBNEJDLEtBRmpFLEVBR0U7QUFDQSxZQUFNeUIsY0FBYyxHQUFHcEMsWUFBWSxDQUNqQzZELFdBQVcsQ0FBQ25ELGVBQVosQ0FBNEJDLEtBREssQ0FBbkM7O0FBR0EsWUFBSXlCLGNBQWMsSUFBSSxJQUF0QixFQUE0QjtBQUMxQkosVUFBQUEsT0FBTyxDQUFDQyxJQUFSLDJDQUVJNEIsV0FBVyxDQUFDbkQsZUFBWixDQUE0QkMsS0FGaEM7QUFLRCxTQU5ELE1BTU87QUFDTGdCLDBDQUF1QlUsUUFBdkIsQ0FDRUQsY0FERixFQUVFeUIsV0FBVyxDQUFDbkQsZUFBWixDQUE0QkUsUUFGOUI7QUFJRDtBQUNGOztBQUNELFVBQUksQ0FBQ2dELFFBQUQsSUFBYUEsUUFBUSxDQUFDN0MsTUFBVCxDQUFnQkosS0FBaEIsS0FBMEJrRCxXQUFXLENBQUM5QyxNQUFaLENBQW1CSixLQUE5RCxFQUFxRTtBQUNuRWdCLHdDQUF1QkMsU0FBdkIsQ0FBaUNpQyxXQUFXLENBQUM5QyxNQUFaLENBQW1CSixLQUFwRDtBQUNEOztBQUNELFVBQUksQ0FBQ2lELFFBQUQsSUFBYUEsUUFBUSxDQUFDOUMsV0FBVCxLQUF5QitDLFdBQVcsQ0FBQy9DLFdBQXRELEVBQW1FO0FBQ2pFYSx3Q0FBdUJXLGNBQXZCLENBQXNDdUIsV0FBVyxDQUFDL0MsV0FBbEQ7QUFDRDtBQUNGOztBQUVESyxJQUFBQSxTQUFTLENBQUNtQyxjQUFWLEdBQTJCTyxXQUEzQjtBQUNELEdBeEV3QyxDQUF6QztBQXlFRCxDOztBQU9IQyxNQUFNLENBQUNDLE9BQVAsR0FBaUI1QyxTQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3dcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZSgnLi4vLi4vVXRpbGl0aWVzL1BsYXRmb3JtJyk7XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5cbmNvbnN0IHByb2Nlc3NDb2xvciA9IHJlcXVpcmUoJy4uLy4uL1N0eWxlU2hlZXQvcHJvY2Vzc0NvbG9yJyk7XG5cbmltcG9ydCBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyIGZyb20gJy4vTmF0aXZlU3RhdHVzQmFyTWFuYWdlcic7XG5cbi8qKlxuICogU3RhdHVzIGJhciBzdHlsZVxuICovXG5leHBvcnQgdHlwZSBTdGF0dXNCYXJTdHlsZSA9ICRLZXlzPHtcbiAgLyoqXG4gICAqIERlZmF1bHQgc3RhdHVzIGJhciBzdHlsZSAoZGFyayBmb3IgaU9TLCBsaWdodCBmb3IgQW5kcm9pZClcbiAgICovXG4gIGRlZmF1bHQ6IHN0cmluZyxcbiAgLyoqXG4gICAqIERhcmsgYmFja2dyb3VuZCwgd2hpdGUgdGV4dHMgYW5kIGljb25zXG4gICAqL1xuICAnbGlnaHQtY29udGVudCc6IHN0cmluZyxcbiAgLyoqXG4gICAqIExpZ2h0IGJhY2tncm91bmQsIGRhcmsgdGV4dHMgYW5kIGljb25zXG4gICAqL1xuICAnZGFyay1jb250ZW50Jzogc3RyaW5nLFxufT47XG5cbi8qKlxuICogU3RhdHVzIGJhciBhbmltYXRpb25cbiAqL1xuZXhwb3J0IHR5cGUgU3RhdHVzQmFyQW5pbWF0aW9uID0gJEtleXM8e1xuICAvKipcbiAgICogTm8gYW5pbWF0aW9uXG4gICAqL1xuICBub25lOiBzdHJpbmcsXG4gIC8qKlxuICAgKiBGYWRlIGFuaW1hdGlvblxuICAgKi9cbiAgZmFkZTogc3RyaW5nLFxuICAvKipcbiAgICogU2xpZGUgYW5pbWF0aW9uXG4gICAqL1xuICBzbGlkZTogc3RyaW5nLFxufT47XG5cbnR5cGUgQW5kcm9pZFByb3BzID0gJFJlYWRPbmx5PHt8XG4gIC8qKlxuICAgKiBUaGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgc3RhdHVzIGJhci5cbiAgICogQHBsYXRmb3JtIGFuZHJvaWRcbiAgICovXG4gIGJhY2tncm91bmRDb2xvcj86ID9zdHJpbmcsXG4gIC8qKlxuICAgKiBJZiB0aGUgc3RhdHVzIGJhciBpcyB0cmFuc2x1Y2VudC5cbiAgICogV2hlbiB0cmFuc2x1Y2VudCBpcyBzZXQgdG8gdHJ1ZSwgdGhlIGFwcCB3aWxsIGRyYXcgdW5kZXIgdGhlIHN0YXR1cyBiYXIuXG4gICAqIFRoaXMgaXMgdXNlZnVsIHdoZW4gdXNpbmcgYSBzZW1pIHRyYW5zcGFyZW50IHN0YXR1cyBiYXIgY29sb3IuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBhbmRyb2lkXG4gICAqL1xuICB0cmFuc2x1Y2VudD86ID9ib29sZWFuLFxufH0+O1xuXG50eXBlIElPU1Byb3BzID0gJFJlYWRPbmx5PHt8XG4gIC8qKlxuICAgKiBJZiB0aGUgbmV0d29yayBhY3Rpdml0eSBpbmRpY2F0b3Igc2hvdWxkIGJlIHZpc2libGUuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBpb3NcbiAgICovXG4gIG5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGU/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIFRoZSB0cmFuc2l0aW9uIGVmZmVjdCB3aGVuIHNob3dpbmcgYW5kIGhpZGluZyB0aGUgc3RhdHVzIGJhciB1c2luZyB0aGUgYGhpZGRlbmBcbiAgICogcHJvcC4gRGVmYXVsdHMgdG8gJ2ZhZGUnLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gaW9zXG4gICAqL1xuICBzaG93SGlkZVRyYW5zaXRpb24/OiA/KCdmYWRlJyB8ICdzbGlkZScpLFxufH0+O1xuXG50eXBlIFByb3BzID0gJFJlYWRPbmx5PHt8XG4gIC4uLkFuZHJvaWRQcm9wcyxcbiAgLi4uSU9TUHJvcHMsXG4gIC8qKlxuICAgKiBJZiB0aGUgc3RhdHVzIGJhciBpcyBoaWRkZW4uXG4gICAqL1xuICBoaWRkZW4/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIElmIHRoZSB0cmFuc2l0aW9uIGJldHdlZW4gc3RhdHVzIGJhciBwcm9wZXJ0eSBjaGFuZ2VzIHNob3VsZCBiZSBhbmltYXRlZC5cbiAgICogU3VwcG9ydGVkIGZvciBiYWNrZ3JvdW5kQ29sb3IsIGJhclN0eWxlIGFuZCBoaWRkZW4uXG4gICAqL1xuICBhbmltYXRlZD86ID9ib29sZWFuLFxuICAvKipcbiAgICogU2V0cyB0aGUgY29sb3Igb2YgdGhlIHN0YXR1cyBiYXIgdGV4dC5cbiAgICovXG4gIGJhclN0eWxlPzogPygnZGVmYXVsdCcgfCAnbGlnaHQtY29udGVudCcgfCAnZGFyay1jb250ZW50JyksXG58fT47XG5cbi8qKlxuICogTWVyZ2VzIHRoZSBwcm9wIHN0YWNrIHdpdGggdGhlIGRlZmF1bHQgdmFsdWVzLlxuICovXG5mdW5jdGlvbiBtZXJnZVByb3BzU3RhY2soXG4gIHByb3BzU3RhY2s6IEFycmF5PE9iamVjdD4sXG4gIGRlZmF1bHRWYWx1ZXM6IE9iamVjdCxcbik6IE9iamVjdCB7XG4gIHJldHVybiBwcm9wc1N0YWNrLnJlZHVjZSgocHJldiwgY3VyKSA9PiB7XG4gICAgZm9yIChjb25zdCBwcm9wIGluIGN1cikge1xuICAgICAgaWYgKGN1cltwcm9wXSAhPSBudWxsKSB7XG4gICAgICAgIHByZXZbcHJvcF0gPSBjdXJbcHJvcF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwcmV2O1xuICB9LCBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0VmFsdWVzKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhbiBvYmplY3QgdG8gaW5zZXJ0IGluIHRoZSBwcm9wcyBzdGFjayBmcm9tIHRoZSBwcm9wc1xuICogYW5kIHRoZSB0cmFuc2l0aW9uL2FuaW1hdGlvbiBpbmZvLlxuICovXG5mdW5jdGlvbiBjcmVhdGVTdGFja0VudHJ5KHByb3BzOiBhbnkpOiBhbnkge1xuICByZXR1cm4ge1xuICAgIGJhY2tncm91bmRDb2xvcjpcbiAgICAgIHByb3BzLmJhY2tncm91bmRDb2xvciAhPSBudWxsXG4gICAgICAgID8ge1xuICAgICAgICAgICAgdmFsdWU6IHByb3BzLmJhY2tncm91bmRDb2xvcixcbiAgICAgICAgICAgIGFuaW1hdGVkOiBwcm9wcy5hbmltYXRlZCxcbiAgICAgICAgICB9XG4gICAgICAgIDogbnVsbCxcbiAgICBiYXJTdHlsZTpcbiAgICAgIHByb3BzLmJhclN0eWxlICE9IG51bGxcbiAgICAgICAgPyB7XG4gICAgICAgICAgICB2YWx1ZTogcHJvcHMuYmFyU3R5bGUsXG4gICAgICAgICAgICBhbmltYXRlZDogcHJvcHMuYW5pbWF0ZWQsXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGwsXG4gICAgdHJhbnNsdWNlbnQ6IHByb3BzLnRyYW5zbHVjZW50LFxuICAgIGhpZGRlbjpcbiAgICAgIHByb3BzLmhpZGRlbiAhPSBudWxsXG4gICAgICAgID8ge1xuICAgICAgICAgICAgdmFsdWU6IHByb3BzLmhpZGRlbixcbiAgICAgICAgICAgIGFuaW1hdGVkOiBwcm9wcy5hbmltYXRlZCxcbiAgICAgICAgICAgIHRyYW5zaXRpb246IHByb3BzLnNob3dIaWRlVHJhbnNpdGlvbixcbiAgICAgICAgICB9XG4gICAgICAgIDogbnVsbCxcbiAgICBuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlOiBwcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlLFxuICB9O1xufVxuXG4vKipcbiAqIENvbXBvbmVudCB0byBjb250cm9sIHRoZSBhcHAgc3RhdHVzIGJhci5cbiAqXG4gKiAjIyMgVXNhZ2Ugd2l0aCBOYXZpZ2F0b3JcbiAqXG4gKiBJdCBpcyBwb3NzaWJsZSB0byBoYXZlIG11bHRpcGxlIGBTdGF0dXNCYXJgIGNvbXBvbmVudHMgbW91bnRlZCBhdCB0aGUgc2FtZVxuICogdGltZS4gVGhlIHByb3BzIHdpbGwgYmUgbWVyZ2VkIGluIHRoZSBvcmRlciB0aGUgYFN0YXR1c0JhcmAgY29tcG9uZW50cyB3ZXJlXG4gKiBtb3VudGVkLiBPbmUgdXNlIGNhc2UgaXMgdG8gc3BlY2lmeSBzdGF0dXMgYmFyIHN0eWxlcyBwZXIgcm91dGUgdXNpbmcgYE5hdmlnYXRvcmAuXG4gKlxuICogYGBgXG4gKiAgPFZpZXc+XG4gKiAgICA8U3RhdHVzQmFyXG4gKiAgICAgIGJhY2tncm91bmRDb2xvcj1cImJsdWVcIlxuICogICAgICBiYXJTdHlsZT1cImxpZ2h0LWNvbnRlbnRcIlxuICogICAgLz5cbiAqICAgIDxOYXZpZ2F0b3JcbiAqICAgICAgaW5pdGlhbFJvdXRlPXt7c3RhdHVzQmFySGlkZGVuOiB0cnVlfX1cbiAqICAgICAgcmVuZGVyU2NlbmU9eyhyb3V0ZSwgbmF2aWdhdG9yKSA9PlxuICogICAgICAgIDxWaWV3PlxuICogICAgICAgICAgPFN0YXR1c0JhciBoaWRkZW49e3JvdXRlLnN0YXR1c0JhckhpZGRlbn0gLz5cbiAqICAgICAgICAgIC4uLlxuICogICAgICAgIDwvVmlldz5cbiAqICAgICAgfVxuICogICAgLz5cbiAqICA8L1ZpZXc+XG4gKiBgYGBcbiAqXG4gKiAjIyMgSW1wZXJhdGl2ZSBBUElcbiAqXG4gKiBGb3IgY2FzZXMgd2hlcmUgdXNpbmcgYSBjb21wb25lbnQgaXMgbm90IGlkZWFsLCB0aGVyZSBhcmUgc3RhdGljIG1ldGhvZHNcbiAqIHRvIG1hbmlwdWxhdGUgdGhlIGBTdGF0dXNCYXJgIGRpc3BsYXkgc3RhY2suIFRoZXNlIG1ldGhvZHMgaGF2ZSB0aGUgc2FtZVxuICogYmVoYXZpb3IgYXMgbW91bnRpbmcgYW5kIHVubW91bnRpbmcgYSBgU3RhdHVzQmFyYCBjb21wb25lbnQuXG4gKlxuICogRm9yIGV4YW1wbGUsIHlvdSBjYW4gY2FsbCBgU3RhdHVzQmFyLnB1c2hTdGFja0VudHJ5YCB0byB1cGRhdGUgdGhlIHN0YXR1cyBiYXJcbiAqIGJlZm9yZSBsYXVuY2hpbmcgYSB0aGlyZC1wYXJ0eSBuYXRpdmUgVUkgY29tcG9uZW50LCBhbmQgdGhlbiBjYWxsXG4gKiBgU3RhdHVzQmFyLnBvcFN0YWNrRW50cnlgIHdoZW4gY29tcGxldGVkLlxuICpcbiAqIGBgYFxuICogY29uc3Qgb3BlblRoaXJkUGFydHlCdWdSZXBvcnRlciA9IGFzeW5jICgpID0+IHtcbiAqICAgLy8gVGhlIGJ1ZyByZXBvcnRlciBoYXMgYSBkYXJrIGJhY2tncm91bmQsIHNvIHdlIHB1c2ggYSBuZXcgc3RhdHVzIGJhciBzdHlsZS5cbiAqICAgY29uc3Qgc3RhY2tFbnRyeSA9IFN0YXR1c0Jhci5wdXNoU3RhY2tFbnRyeSh7YmFyU3R5bGU6ICdsaWdodC1jb250ZW50J30pO1xuICpcbiAqICAgLy8gYG9wZW5gIHJldHVybnMgYSBwcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2hlbiB0aGUgVUkgaXMgZGlzbWlzc2VkLlxuICogICBhd2FpdCBCdWdSZXBvcnRlci5vcGVuKCk7XG4gKlxuICogICAvLyBEb24ndCBmb3JnZXQgdG8gY2FsbCBgcG9wU3RhY2tFbnRyeWAgd2hlbiB5b3UncmUgZG9uZS5cbiAqICAgU3RhdHVzQmFyLnBvcFN0YWNrRW50cnkoc3RhY2tFbnRyeSk7XG4gKiB9O1xuICogYGBgXG4gKlxuICogVGhlcmUgaXMgYSBsZWdhY3kgaW1wZXJhdGl2ZSBBUEkgdGhhdCBlbmFibGVzIHlvdSB0byBtYW51YWxseSB1cGRhdGUgdGhlXG4gKiBzdGF0dXMgYmFyIHN0eWxlcy4gSG93ZXZlciwgdGhlIGxlZ2FjeSBBUEkgZG9lcyBub3QgdXBkYXRlIHRoZSBpbnRlcm5hbFxuICogYFN0YXR1c0JhcmAgZGlzcGxheSBzdGFjaywgd2hpY2ggbWVhbnMgdGhhdCBhbnkgY2hhbmdlcyB3aWxsIGJlIG92ZXJyaWRkZW5cbiAqIHdoZW5ldmVyIGEgYFN0YXR1c0JhcmAgY29tcG9uZW50IGlzIG1vdW50ZWQgb3IgdW5tb3VudGVkLlxuICpcbiAqIEl0IGlzIHN0cm9uZ2x5IGFkdmlzZWQgdGhhdCB5b3UgdXNlIGBwdXNoU3RhY2tFbnRyeWAsIGBwb3BTdGFja0VudHJ5YCwgb3JcbiAqIGByZXBsYWNlU3RhY2tFbnRyeWAgaW5zdGVhZCBvZiB0aGUgc3RhdGljIG1ldGhvZHMgYmVnaW5uaW5nIHdpdGggYHNldGAuXG4gKlxuICogIyMjIENvbnN0YW50c1xuICpcbiAqIGBjdXJyZW50SGVpZ2h0YCAoQW5kcm9pZCBvbmx5KSBUaGUgaGVpZ2h0IG9mIHRoZSBzdGF0dXMgYmFyLlxuICovXG5jbGFzcyBTdGF0dXNCYXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQ8UHJvcHM+IHtcbiAgc3RhdGljIF9wcm9wc1N0YWNrID0gW107XG5cbiAgc3RhdGljIF9kZWZhdWx0UHJvcHMgPSBjcmVhdGVTdGFja0VudHJ5KHtcbiAgICBhbmltYXRlZDogZmFsc2UsXG4gICAgc2hvd0hpZGVUcmFuc2l0aW9uOiAnZmFkZScsXG4gICAgYmFja2dyb3VuZENvbG9yOiBQbGF0Zm9ybS5zZWxlY3Qoe1xuICAgICAgYW5kcm9pZDpcbiAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlci5nZXRDb25zdGFudHMoKS5ERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1IgPz9cbiAgICAgICAgJ2JsYWNrJyxcbiAgICAgIGlvczogJ2JsYWNrJyxcbiAgICB9KSxcbiAgICBiYXJTdHlsZTogJ2RlZmF1bHQnLFxuICAgIHRyYW5zbHVjZW50OiBmYWxzZSxcbiAgICBoaWRkZW46IGZhbHNlLFxuICAgIG5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGU6IGZhbHNlLFxuICB9KTtcblxuICAvLyBUaW1lciBmb3IgdXBkYXRpbmcgdGhlIG5hdGl2ZSBtb2R1bGUgdmFsdWVzIGF0IHRoZSBlbmQgb2YgdGhlIGZyYW1lLlxuICBzdGF0aWMgX3VwZGF0ZUltbWVkaWF0ZSA9IG51bGw7XG5cbiAgLy8gVGhlIGN1cnJlbnQgbWVyZ2VkIHZhbHVlcyBmcm9tIHRoZSBwcm9wcyBzdGFjay5cbiAgc3RhdGljIF9jdXJyZW50VmFsdWVzID0gbnVsbDtcblxuICAvLyBUT0RPKGphbmljKTogUHJvdmlkZSBhIHJlYWwgQVBJIHRvIGRlYWwgd2l0aCBzdGF0dXMgYmFyIGhlaWdodC4gU2VlIHRoZVxuICAvLyBkaXNjdXNzaW9uIGluICM2MTk1LlxuICAvKipcbiAgICogVGhlIGN1cnJlbnQgaGVpZ2h0IG9mIHRoZSBzdGF0dXMgYmFyIG9uIHRoZSBkZXZpY2UuXG4gICAqXG4gICAqIEBwbGF0Zm9ybSBhbmRyb2lkXG4gICAqL1xuICBzdGF0aWMgY3VycmVudEhlaWdodDogbnVtYmVyID0gTmF0aXZlU3RhdHVzQmFyTWFuYWdlci5nZXRDb25zdGFudHMoKS5IRUlHSFQ7XG5cbiAgLy8gUHJvdmlkZSBhbiBpbXBlcmF0aXZlIEFQSSBhcyBzdGF0aWMgZnVuY3Rpb25zIG9mIHRoZSBjb21wb25lbnQuXG4gIC8vIFNlZSB0aGUgY29ycmVzcG9uZGluZyBwcm9wIGZvciBtb3JlIGRldGFpbC5cblxuICAvKipcbiAgICogU2hvdyBvciBoaWRlIHRoZSBzdGF0dXMgYmFyXG4gICAqIEBwYXJhbSBoaWRkZW4gSGlkZSB0aGUgc3RhdHVzIGJhci5cbiAgICogQHBhcmFtIGFuaW1hdGlvbiBPcHRpb25hbCBhbmltYXRpb24gd2hlblxuICAgKiAgICBjaGFuZ2luZyB0aGUgc3RhdHVzIGJhciBoaWRkZW4gcHJvcGVydHkuXG4gICAqL1xuICBzdGF0aWMgc2V0SGlkZGVuKGhpZGRlbjogYm9vbGVhbiwgYW5pbWF0aW9uPzogU3RhdHVzQmFyQW5pbWF0aW9uKSB7XG4gICAgYW5pbWF0aW9uID0gYW5pbWF0aW9uIHx8ICdub25lJztcbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy5oaWRkZW4udmFsdWUgPSBoaWRkZW47XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlci5zZXRIaWRkZW4oaGlkZGVuLCBhbmltYXRpb24pO1xuICAgIH0gZWxzZSBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlci5zZXRIaWRkZW4oaGlkZGVuKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBzdGF0dXMgYmFyIHN0eWxlXG4gICAqIEBwYXJhbSBzdHlsZSBTdGF0dXMgYmFyIHN0eWxlIHRvIHNldFxuICAgKiBAcGFyYW0gYW5pbWF0ZWQgQW5pbWF0ZSB0aGUgc3R5bGUgY2hhbmdlLlxuICAgKi9cbiAgc3RhdGljIHNldEJhclN0eWxlKHN0eWxlOiBTdGF0dXNCYXJTdHlsZSwgYW5pbWF0ZWQ/OiBib29sZWFuKSB7XG4gICAgYW5pbWF0ZWQgPSBhbmltYXRlZCB8fCBmYWxzZTtcbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy5iYXJTdHlsZS52YWx1ZSA9IHN0eWxlO1xuICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2lvcycpIHtcbiAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXIuc2V0U3R5bGUoc3R5bGUsIGFuaW1hdGVkKTtcbiAgICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXIuc2V0U3R5bGUoc3R5bGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb250cm9sIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBuZXR3b3JrIGFjdGl2aXR5IGluZGljYXRvclxuICAgKiBAcGFyYW0gdmlzaWJsZSBTaG93IHRoZSBpbmRpY2F0b3IuXG4gICAqL1xuICBzdGF0aWMgc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSh2aXNpYmxlOiBib29sZWFuKSB7XG4gICAgaWYgKFBsYXRmb3JtLk9TICE9PSAnaW9zJykge1xuICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAnYHNldE5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGVgIGlzIG9ubHkgYXZhaWxhYmxlIG9uIGlPUycsXG4gICAgICApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlID0gdmlzaWJsZTtcbiAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldE5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUodmlzaWJsZSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBiYWNrZ3JvdW5kIGNvbG9yIGZvciB0aGUgc3RhdHVzIGJhclxuICAgKiBAcGFyYW0gY29sb3IgQmFja2dyb3VuZCBjb2xvci5cbiAgICogQHBhcmFtIGFuaW1hdGVkIEFuaW1hdGUgdGhlIHN0eWxlIGNoYW5nZS5cbiAgICovXG4gIHN0YXRpYyBzZXRCYWNrZ3JvdW5kQ29sb3IoY29sb3I6IHN0cmluZywgYW5pbWF0ZWQ/OiBib29sZWFuKSB7XG4gICAgaWYgKFBsYXRmb3JtLk9TICE9PSAnYW5kcm9pZCcpIHtcbiAgICAgIGNvbnNvbGUud2FybignYHNldEJhY2tncm91bmRDb2xvcmAgaXMgb25seSBhdmFpbGFibGUgb24gQW5kcm9pZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBhbmltYXRlZCA9IGFuaW1hdGVkIHx8IGZhbHNlO1xuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLmJhY2tncm91bmRDb2xvci52YWx1ZSA9IGNvbG9yO1xuXG4gICAgY29uc3QgcHJvY2Vzc2VkQ29sb3IgPSBwcm9jZXNzQ29sb3IoY29sb3IpO1xuICAgIGlmIChwcm9jZXNzZWRDb2xvciA9PSBudWxsKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBcXGBTdGF0dXNCYXIuc2V0QmFja2dyb3VuZENvbG9yXFxgOiBDb2xvciAke2NvbG9yfSBwYXJzZWQgdG8gbnVsbCBvciB1bmRlZmluZWRgLFxuICAgICAgKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldENvbG9yKHByb2Nlc3NlZENvbG9yLCBhbmltYXRlZCk7XG4gIH1cblxuICAvKipcbiAgICogQ29udHJvbCB0aGUgdHJhbnNsdWNlbmN5IG9mIHRoZSBzdGF0dXMgYmFyXG4gICAqIEBwYXJhbSB0cmFuc2x1Y2VudCBTZXQgYXMgdHJhbnNsdWNlbnQuXG4gICAqL1xuICBzdGF0aWMgc2V0VHJhbnNsdWNlbnQodHJhbnNsdWNlbnQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJykge1xuICAgICAgY29uc29sZS53YXJuKCdgc2V0VHJhbnNsdWNlbnRgIGlzIG9ubHkgYXZhaWxhYmxlIG9uIEFuZHJvaWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMudHJhbnNsdWNlbnQgPSB0cmFuc2x1Y2VudDtcbiAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldFRyYW5zbHVjZW50KHRyYW5zbHVjZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdXNoIGEgU3RhdHVzQmFyIGVudHJ5IG9udG8gdGhlIHN0YWNrLlxuICAgKiBUaGUgcmV0dXJuIHZhbHVlIHNob3VsZCBiZSBwYXNzZWQgdG8gYHBvcFN0YWNrRW50cnlgIHdoZW4gY29tcGxldGUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyBPYmplY3QgY29udGFpbmluZyB0aGUgU3RhdHVzQmFyIHByb3BzIHRvIHVzZSBpbiB0aGUgc3RhY2sgZW50cnkuXG4gICAqL1xuICBzdGF0aWMgcHVzaFN0YWNrRW50cnkocHJvcHM6IGFueSk6IGFueSB7XG4gICAgY29uc3QgZW50cnkgPSBjcmVhdGVTdGFja0VudHJ5KHByb3BzKTtcbiAgICBTdGF0dXNCYXIuX3Byb3BzU3RhY2sucHVzaChlbnRyeSk7XG4gICAgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrKCk7XG4gICAgcmV0dXJuIGVudHJ5O1xuICB9XG5cbiAgLyoqXG4gICAqIFBvcCBhIFN0YXR1c0JhciBlbnRyeSBmcm9tIHRoZSBzdGFjay5cbiAgICpcbiAgICogQHBhcmFtIGVudHJ5IEVudHJ5IHJldHVybmVkIGZyb20gYHB1c2hTdGFja0VudHJ5YC5cbiAgICovXG4gIHN0YXRpYyBwb3BTdGFja0VudHJ5KGVudHJ5OiBhbnkpIHtcbiAgICBjb25zdCBpbmRleCA9IFN0YXR1c0Jhci5fcHJvcHNTdGFjay5pbmRleE9mKGVudHJ5KTtcbiAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICBTdGF0dXNCYXIuX3Byb3BzU3RhY2suc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrKCk7XG4gIH1cblxuICAvKipcbiAgICogUmVwbGFjZSBhbiBleGlzdGluZyBTdGF0dXNCYXIgc3RhY2sgZW50cnkgd2l0aCBuZXcgcHJvcHMuXG4gICAqXG4gICAqIEBwYXJhbSBlbnRyeSBFbnRyeSByZXR1cm5lZCBmcm9tIGBwdXNoU3RhY2tFbnRyeWAgdG8gcmVwbGFjZS5cbiAgICogQHBhcmFtIHByb3BzIE9iamVjdCBjb250YWluaW5nIHRoZSBTdGF0dXNCYXIgcHJvcHMgdG8gdXNlIGluIHRoZSByZXBsYWNlbWVudCBzdGFjayBlbnRyeS5cbiAgICovXG4gIHN0YXRpYyByZXBsYWNlU3RhY2tFbnRyeShlbnRyeTogYW55LCBwcm9wczogYW55KTogYW55IHtcbiAgICBjb25zdCBuZXdFbnRyeSA9IGNyZWF0ZVN0YWNrRW50cnkocHJvcHMpO1xuICAgIGNvbnN0IGluZGV4ID0gU3RhdHVzQmFyLl9wcm9wc1N0YWNrLmluZGV4T2YoZW50cnkpO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIFN0YXR1c0Jhci5fcHJvcHNTdGFja1tpbmRleF0gPSBuZXdFbnRyeTtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrKCk7XG4gICAgcmV0dXJuIG5ld0VudHJ5O1xuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wczogJFRFTVBPUkFSWSRvYmplY3Q8e3xcbiAgICBhbmltYXRlZDogYm9vbGVhbixcbiAgICBzaG93SGlkZVRyYW5zaXRpb246ICRURU1QT1JBUlkkc3RyaW5nPCdmYWRlJz4sXG4gIHx9PiA9IHtcbiAgICBhbmltYXRlZDogZmFsc2UsXG4gICAgc2hvd0hpZGVUcmFuc2l0aW9uOiAnZmFkZScsXG4gIH07XG5cbiAgX3N0YWNrRW50cnkgPSBudWxsO1xuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIC8vIEV2ZXJ5IHRpbWUgYSBTdGF0dXNCYXIgY29tcG9uZW50IGlzIG1vdW50ZWQsIHdlIHB1c2ggaXQncyBwcm9wIHRvIGEgc3RhY2tcbiAgICAvLyBhbmQgYWx3YXlzIHVwZGF0ZSB0aGUgbmF0aXZlIHN0YXR1cyBiYXIgd2l0aCB0aGUgcHJvcHMgZnJvbSB0aGUgdG9wIG9mIHRoZW5cbiAgICAvLyBzdGFjay4gVGhpcyBhbGxvd3MgaGF2aW5nIG11bHRpcGxlIFN0YXR1c0JhciBjb21wb25lbnRzIGFuZCB0aGUgb25lIHRoYXQgaXNcbiAgICAvLyBhZGRlZCBsYXN0IG9yIGlzIGRlZXBlciBpbiB0aGUgdmlldyBoaWVyYXJjaHkgd2lsbCBoYXZlIHByaW9yaXR5LlxuICAgIHRoaXMuX3N0YWNrRW50cnkgPSBTdGF0dXNCYXIucHVzaFN0YWNrRW50cnkodGhpcy5wcm9wcyk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAvLyBXaGVuIGEgU3RhdHVzQmFyIGlzIHVubW91bnRlZCwgcmVtb3ZlIGl0c2VsZiBmcm9tIHRoZSBzdGFjayBhbmQgdXBkYXRlXG4gICAgLy8gdGhlIG5hdGl2ZSBiYXIgd2l0aCB0aGUgbmV4dCBwcm9wcy5cbiAgICBTdGF0dXNCYXIucG9wU3RhY2tFbnRyeSh0aGlzLl9zdGFja0VudHJ5KTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLl9zdGFja0VudHJ5ID0gU3RhdHVzQmFyLnJlcGxhY2VTdGFja0VudHJ5KFxuICAgICAgdGhpcy5fc3RhY2tFbnRyeSxcbiAgICAgIHRoaXMucHJvcHMsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHRoZSBuYXRpdmUgc3RhdHVzIGJhciB3aXRoIHRoZSBwcm9wcyBmcm9tIHRoZSBzdGFjay5cbiAgICovXG4gIHN0YXRpYyBfdXBkYXRlUHJvcHNTdGFjayA9ICgpID0+IHtcbiAgICAvLyBTZW5kIHRoZSB1cGRhdGUgdG8gdGhlIG5hdGl2ZSBtb2R1bGUgb25seSBvbmNlIGF0IHRoZSBlbmQgb2YgdGhlIGZyYW1lLlxuICAgIGNsZWFySW1tZWRpYXRlKFN0YXR1c0Jhci5fdXBkYXRlSW1tZWRpYXRlKTtcbiAgICBTdGF0dXNCYXIuX3VwZGF0ZUltbWVkaWF0ZSA9IHNldEltbWVkaWF0ZSgoKSA9PiB7XG4gICAgICBjb25zdCBvbGRQcm9wcyA9IFN0YXR1c0Jhci5fY3VycmVudFZhbHVlcztcbiAgICAgIGNvbnN0IG1lcmdlZFByb3BzID0gbWVyZ2VQcm9wc1N0YWNrKFxuICAgICAgICBTdGF0dXNCYXIuX3Byb3BzU3RhY2ssXG4gICAgICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLFxuICAgICAgKTtcblxuICAgICAgLy8gVXBkYXRlIHRoZSBwcm9wcyB0aGF0IGhhdmUgY2hhbmdlZCB1c2luZyB0aGUgbWVyZ2VkIHZhbHVlcyBmcm9tIHRoZSBwcm9wcyBzdGFjay5cbiAgICAgIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2lvcycpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFvbGRQcm9wcyB8fFxuICAgICAgICAgIG9sZFByb3BzLmJhclN0eWxlLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5iYXJTdHlsZS52YWx1ZVxuICAgICAgICApIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldFN0eWxlKFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMuYmFyU3R5bGUudmFsdWUsXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5iYXJTdHlsZS5hbmltYXRlZCB8fCBmYWxzZSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb2xkUHJvcHMgfHwgb2xkUHJvcHMuaGlkZGVuLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUpIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldEhpZGRlbihcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmhpZGRlbi52YWx1ZSxcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmhpZGRlbi5hbmltYXRlZFxuICAgICAgICAgICAgICA/IG1lcmdlZFByb3BzLmhpZGRlbi50cmFuc2l0aW9uXG4gICAgICAgICAgICAgIDogJ25vbmUnLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoXG4gICAgICAgICAgIW9sZFByb3BzIHx8XG4gICAgICAgICAgb2xkUHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSAhPT1cbiAgICAgICAgICAgIG1lcmdlZFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGVcbiAgICAgICAgKSB7XG4gICAgICAgICAgTmF0aXZlU3RhdHVzQmFyTWFuYWdlci5zZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlKFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKFBsYXRmb3JtLk9TID09PSAnYW5kcm9pZCcpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFvbGRQcm9wcyB8fFxuICAgICAgICAgIG9sZFByb3BzLmJhclN0eWxlLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5iYXJTdHlsZS52YWx1ZVxuICAgICAgICApIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldFN0eWxlKG1lcmdlZFByb3BzLmJhclN0eWxlLnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXG4gICAgICAgICAgIW9sZFByb3BzIHx8XG4gICAgICAgICAgb2xkUHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5iYWNrZ3JvdW5kQ29sb3IudmFsdWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29uc3QgcHJvY2Vzc2VkQ29sb3IgPSBwcm9jZXNzQ29sb3IoXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5iYWNrZ3JvdW5kQ29sb3IudmFsdWUsXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAocHJvY2Vzc2VkQ29sb3IgPT0gbnVsbCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgICBgXFxgU3RhdHVzQmFyLl91cGRhdGVQcm9wc1N0YWNrXFxgOiBDb2xvciAke1xuICAgICAgICAgICAgICAgIG1lcmdlZFByb3BzLmJhY2tncm91bmRDb2xvci52YWx1ZVxuICAgICAgICAgICAgICB9IHBhcnNlZCB0byBudWxsIG9yIHVuZGVmaW5lZGAsXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldENvbG9yKFxuICAgICAgICAgICAgICBwcm9jZXNzZWRDb2xvcixcbiAgICAgICAgICAgICAgbWVyZ2VkUHJvcHMuYmFja2dyb3VuZENvbG9yLmFuaW1hdGVkLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvbGRQcm9wcyB8fCBvbGRQcm9wcy5oaWRkZW4udmFsdWUgIT09IG1lcmdlZFByb3BzLmhpZGRlbi52YWx1ZSkge1xuICAgICAgICAgIE5hdGl2ZVN0YXR1c0Jhck1hbmFnZXIuc2V0SGlkZGVuKG1lcmdlZFByb3BzLmhpZGRlbi52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFvbGRQcm9wcyB8fCBvbGRQcm9wcy50cmFuc2x1Y2VudCAhPT0gbWVyZ2VkUHJvcHMudHJhbnNsdWNlbnQpIHtcbiAgICAgICAgICBOYXRpdmVTdGF0dXNCYXJNYW5hZ2VyLnNldFRyYW5zbHVjZW50KG1lcmdlZFByb3BzLnRyYW5zbHVjZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gVXBkYXRlIHRoZSBjdXJyZW50IHByb3AgdmFsdWVzLlxuICAgICAgU3RhdHVzQmFyLl9jdXJyZW50VmFsdWVzID0gbWVyZ2VkUHJvcHM7XG4gICAgfSk7XG4gIH07XG5cbiAgcmVuZGVyKCk6IFJlYWN0Lk5vZGUge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gU3RhdHVzQmFyO1xuIl19