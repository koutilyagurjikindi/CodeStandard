1d9eac4fc666c05d89ad0b40ff76339a
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _wrapNativeSuper2 = _interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));

var SyntheticError = function (_Error) {
  (0, _inherits2.default)(SyntheticError, _Error);

  function SyntheticError() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2.default)(this, SyntheticError);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(SyntheticError)).call.apply(_getPrototypeOf2, [this].concat(args)));
    _this.name = '';
    return _this;
  }

  return SyntheticError;
}((0, _wrapNativeSuper2.default)(Error));

var exceptionID = 0;

function reportException(e, isFatal) {
  var NativeExceptionsManager = require('./NativeExceptionsManager').default;

  if (NativeExceptionsManager) {
    var parseErrorStack = require('./Devtools/parseErrorStack');

    var stack = parseErrorStack(e);
    var currentExceptionID = ++exceptionID;
    var originalMessage = e.message || '';
    var message = originalMessage;

    if (e.componentStack != null) {
      message += "\n\nThis error is located at:" + e.componentStack;
    }

    var namePrefix = e.name == null || e.name === '' ? '' : e.name + ": ";
    var isFromConsoleError = e.name === 'console.error';

    if (!message.startsWith(namePrefix)) {
      message = namePrefix + message;
    }

    if (!isFromConsoleError) {
      if (console._errorOriginal) {
        console._errorOriginal(message);
      } else {
        console.error(message);
      }
    }

    message = e.jsEngine == null ? message : message + ", js engine: " + e.jsEngine;
    NativeExceptionsManager.reportException({
      message: message,
      originalMessage: message === originalMessage ? null : originalMessage,
      name: e.name == null || e.name === '' ? null : e.name,
      componentStack: typeof e.componentStack === 'string' ? e.componentStack : null,
      stack: stack,
      id: currentExceptionID,
      isFatal: isFatal,
      extraData: {
        jsEngine: e.jsEngine,
        rawStack: e.stack,
        framesPopped: e.framesToPop
      }
    });

    if (__DEV__) {
      if (e.preventSymbolication === true) {
        return;
      }

      var symbolicateStackTrace = require('./Devtools/symbolicateStackTrace');

      symbolicateStackTrace(stack).then(function (prettyStack) {
        if (prettyStack) {
          var stackWithoutCollapsedFrames = prettyStack.filter(function (frame) {
            return !frame.collapse;
          });
          NativeExceptionsManager.updateExceptionMessage(message, stackWithoutCollapsedFrames, currentExceptionID);
        } else {
          throw new Error('The stack is null');
        }
      }).catch(function (error) {
        console.log('Unable to symbolicate stack trace: ' + error.message);
      });
    }
  }
}

function handleException(e, isFatal) {
  var error;

  if (e instanceof Error) {
    error = e;
  } else {
    error = new SyntheticError(e);
  }

  reportException(error, isFatal);
}

function reactConsoleErrorHandler() {
  if (!console.reportErrorsAsExceptions) {
    console._errorOriginal.apply(console, arguments);

    return;
  }

  if (arguments[0] && arguments[0].stack) {
    reportException(arguments[0], false);
  } else {
    console._errorOriginal.apply(console, arguments);

    var stringifySafe = require('../Utilities/stringifySafe');

    var str = Array.prototype.map.call(arguments, stringifySafe).join(', ');

    if (str.slice(0, 10) === '"Warning: ') {
      return;
    }

    var _error = new SyntheticError(str);

    _error.name = 'console.error';
    _error.framesToPop = (_error.framesToPop || 0) + 1;
    reportException(_error, false);
  }
}

function installConsoleErrorReporter() {
  if (console._errorOriginal) {
    return;
  }

  console._errorOriginal = console.error.bind(console);
  console.error = reactConsoleErrorHandler;

  if (console.reportErrorsAsExceptions === undefined) {
    console.reportErrorsAsExceptions = true;
  }
}

module.exports = {
  handleException: handleException,
  installConsoleErrorReporter: installConsoleErrorReporter,
  SyntheticError: SyntheticError
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV4Y2VwdGlvbnNNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIlN5bnRoZXRpY0Vycm9yIiwibmFtZSIsIkVycm9yIiwiZXhjZXB0aW9uSUQiLCJyZXBvcnRFeGNlcHRpb24iLCJlIiwiaXNGYXRhbCIsIk5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyIiwicmVxdWlyZSIsImRlZmF1bHQiLCJwYXJzZUVycm9yU3RhY2siLCJzdGFjayIsImN1cnJlbnRFeGNlcHRpb25JRCIsIm9yaWdpbmFsTWVzc2FnZSIsIm1lc3NhZ2UiLCJjb21wb25lbnRTdGFjayIsIm5hbWVQcmVmaXgiLCJpc0Zyb21Db25zb2xlRXJyb3IiLCJzdGFydHNXaXRoIiwiY29uc29sZSIsIl9lcnJvck9yaWdpbmFsIiwiZXJyb3IiLCJqc0VuZ2luZSIsImlkIiwiZXh0cmFEYXRhIiwicmF3U3RhY2siLCJmcmFtZXNQb3BwZWQiLCJmcmFtZXNUb1BvcCIsIl9fREVWX18iLCJwcmV2ZW50U3ltYm9saWNhdGlvbiIsInN5bWJvbGljYXRlU3RhY2tUcmFjZSIsInRoZW4iLCJwcmV0dHlTdGFjayIsInN0YWNrV2l0aG91dENvbGxhcHNlZEZyYW1lcyIsImZpbHRlciIsImZyYW1lIiwiY29sbGFwc2UiLCJ1cGRhdGVFeGNlcHRpb25NZXNzYWdlIiwiY2F0Y2giLCJsb2ciLCJoYW5kbGVFeGNlcHRpb24iLCJyZWFjdENvbnNvbGVFcnJvckhhbmRsZXIiLCJyZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMiLCJhcHBseSIsImFyZ3VtZW50cyIsInN0cmluZ2lmeVNhZmUiLCJzdHIiLCJBcnJheSIsInByb3RvdHlwZSIsIm1hcCIsImNhbGwiLCJqb2luIiwic2xpY2UiLCJpbnN0YWxsQ29uc29sZUVycm9yUmVwb3J0ZXIiLCJiaW5kIiwidW5kZWZpbmVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7Ozs7O0lBSU1BLGM7Ozs7Ozs7Ozs7Ozs7OztVQUNKQyxJLEdBQWUsRTs7Ozs7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bUMsSUFBbkM7QUFDRDtBQUNGOztBQUVEYyxNQUFNLENBQUNDLE9BQVAsR0FBaUI7QUFBQ2pCLEVBQUFBLGVBQWUsRUFBZkEsZUFBRDtBQUFrQmEsRUFBQUEsMkJBQTJCLEVBQTNCQSwyQkFBbEI7QUFBK0NyRCxFQUFBQSxjQUFjLEVBQWRBO0FBQS9DLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCB0eXBlIHtFeHRlbmRlZEVycm9yfSBmcm9tICcuL0RldnRvb2xzL3BhcnNlRXJyb3JTdGFjayc7XG5cbmNsYXNzIFN5bnRoZXRpY0Vycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBuYW1lOiBzdHJpbmcgPSAnJztcbn1cblxuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXZlbG9wZXItdmlzaWJsZSBhc3BlY3Qgb2YgZXJyb3JzIGFuZCBleGNlcHRpb25zXG4gKi9cbmxldCBleGNlcHRpb25JRCA9IDA7XG5mdW5jdGlvbiByZXBvcnRFeGNlcHRpb24oZTogRXh0ZW5kZWRFcnJvciwgaXNGYXRhbDogYm9vbGVhbikge1xuICBjb25zdCBOYXRpdmVFeGNlcHRpb25zTWFuYWdlciA9IHJlcXVpcmUoJy4vTmF0aXZlRXhjZXB0aW9uc01hbmFnZXInKS5kZWZhdWx0O1xuICBpZiAoTmF0aXZlRXhjZXB0aW9uc01hbmFnZXIpIHtcbiAgICBjb25zdCBwYXJzZUVycm9yU3RhY2sgPSByZXF1aXJlKCcuL0RldnRvb2xzL3BhcnNlRXJyb3JTdGFjaycpO1xuICAgIGNvbnN0IHN0YWNrID0gcGFyc2VFcnJvclN0YWNrKGUpO1xuICAgIGNvbnN0IGN1cnJlbnRFeGNlcHRpb25JRCA9ICsrZXhjZXB0aW9uSUQ7XG4gICAgY29uc3Qgb3JpZ2luYWxNZXNzYWdlID0gZS5tZXNzYWdlIHx8ICcnO1xuICAgIGxldCBtZXNzYWdlID0gb3JpZ2luYWxNZXNzYWdlO1xuICAgIGlmIChlLmNvbXBvbmVudFN0YWNrICE9IG51bGwpIHtcbiAgICAgIG1lc3NhZ2UgKz0gYFxcblxcblRoaXMgZXJyb3IgaXMgbG9jYXRlZCBhdDoke2UuY29tcG9uZW50U3RhY2t9YDtcbiAgICB9XG4gICAgY29uc3QgbmFtZVByZWZpeCA9IGUubmFtZSA9PSBudWxsIHx8IGUubmFtZSA9PT0gJycgPyAnJyA6IGAke2UubmFtZX06IGA7XG4gICAgY29uc3QgaXNGcm9tQ29uc29sZUVycm9yID0gZS5uYW1lID09PSAnY29uc29sZS5lcnJvcic7XG5cbiAgICBpZiAoIW1lc3NhZ2Uuc3RhcnRzV2l0aChuYW1lUHJlZml4KSkge1xuICAgICAgbWVzc2FnZSA9IG5hbWVQcmVmaXggKyBtZXNzYWdlO1xuICAgIH1cblxuICAgIC8vIEVycm9ycyBjcmVhdGVkIGJ5IGBjb25zb2xlLmVycm9yYCBoYXZlIGFscmVhZHkgYmVlbiBwcmludGVkLlxuICAgIGlmICghaXNGcm9tQ29uc29sZUVycm9yKSB7XG4gICAgICBpZiAoY29uc29sZS5fZXJyb3JPcmlnaW5hbCkge1xuICAgICAgICBjb25zb2xlLl9lcnJvck9yaWdpbmFsKG1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihtZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBtZXNzYWdlID1cbiAgICAgIGUuanNFbmdpbmUgPT0gbnVsbCA/IG1lc3NhZ2UgOiBgJHttZXNzYWdlfSwganMgZW5naW5lOiAke2UuanNFbmdpbmV9YDtcbiAgICBOYXRpdmVFeGNlcHRpb25zTWFuYWdlci5yZXBvcnRFeGNlcHRpb24oe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIG9yaWdpbmFsTWVzc2FnZTogbWVzc2FnZSA9PT0gb3JpZ2luYWxNZXNzYWdlID8gbnVsbCA6IG9yaWdpbmFsTWVzc2FnZSxcbiAgICAgIG5hbWU6IGUubmFtZSA9PSBudWxsIHx8IGUubmFtZSA9PT0gJycgPyBudWxsIDogZS5uYW1lLFxuICAgICAgY29tcG9uZW50U3RhY2s6XG4gICAgICAgIHR5cGVvZiBlLmNvbXBvbmVudFN0YWNrID09PSAnc3RyaW5nJyA/IGUuY29tcG9uZW50U3RhY2sgOiBudWxsLFxuICAgICAgc3RhY2ssXG4gICAgICBpZDogY3VycmVudEV4Y2VwdGlvbklELFxuICAgICAgaXNGYXRhbCxcbiAgICAgIGV4dHJhRGF0YToge1xuICAgICAgICBqc0VuZ2luZTogZS5qc0VuZ2luZSxcbiAgICAgICAgcmF3U3RhY2s6IGUuc3RhY2ssXG4gICAgICAgIGZyYW1lc1BvcHBlZDogZS5mcmFtZXNUb1BvcCxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgaWYgKF9fREVWX18pIHtcbiAgICAgIGlmIChlLnByZXZlbnRTeW1ib2xpY2F0aW9uID09PSB0cnVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN5bWJvbGljYXRlU3RhY2tUcmFjZSA9IHJlcXVpcmUoJy4vRGV2dG9vbHMvc3ltYm9saWNhdGVTdGFja1RyYWNlJyk7XG4gICAgICBzeW1ib2xpY2F0ZVN0YWNrVHJhY2Uoc3RhY2spXG4gICAgICAgIC50aGVuKHByZXR0eVN0YWNrID0+IHtcbiAgICAgICAgICBpZiAocHJldHR5U3RhY2spIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YWNrV2l0aG91dENvbGxhcHNlZEZyYW1lcyA9IHByZXR0eVN0YWNrLmZpbHRlcihcbiAgICAgICAgICAgICAgZnJhbWUgPT4gIWZyYW1lLmNvbGxhcHNlLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIE5hdGl2ZUV4Y2VwdGlvbnNNYW5hZ2VyLnVwZGF0ZUV4Y2VwdGlvbk1lc3NhZ2UoXG4gICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgIHN0YWNrV2l0aG91dENvbGxhcHNlZEZyYW1lcyxcbiAgICAgICAgICAgICAgY3VycmVudEV4Y2VwdGlvbklELFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgc3RhY2sgaXMgbnVsbCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnVW5hYmxlIHRvIHN5bWJvbGljYXRlIHN0YWNrIHRyYWNlOiAnICsgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5kZWNsYXJlIHZhciBjb25zb2xlOiB0eXBlb2YgY29uc29sZSAmIHtcbiAgX2Vycm9yT3JpZ2luYWw6IHR5cGVvZiBjb25zb2xlLmVycm9yLFxuICByZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnM6IGJvb2xlYW4sXG59O1xuXG4vKipcbiAqIExvZ3MgZXhjZXB0aW9ucyB0byB0aGUgKG5hdGl2ZSkgY29uc29sZSBhbmQgZGlzcGxheXMgdGhlbVxuICovXG5mdW5jdGlvbiBoYW5kbGVFeGNlcHRpb24oZTogbWl4ZWQsIGlzRmF0YWw6IGJvb2xlYW4pIHtcbiAgbGV0IGVycm9yOiBFcnJvcjtcbiAgaWYgKGUgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIGVycm9yID0gZTtcbiAgfSBlbHNlIHtcbiAgICAvLyBXb3JrYXJvdW5kIGZvciByZXBvcnRpbmcgZXJyb3JzIGNhdXNlZCBieSBgdGhyb3cgJ3NvbWUgc3RyaW5nJ2BcbiAgICAvLyBVbmZvcnR1bmF0ZWx5IHRoZXJlIGlzIG5vIHdheSB0byBmaWd1cmUgb3V0IHRoZSBzdGFja3RyYWNlIGluIHRoaXNcbiAgICAvLyBjYXNlLCBzbyBpZiB5b3UgZW5kZWQgdXAgaGVyZSB0cnlpbmcgdG8gdHJhY2UgYW4gZXJyb3IsIGxvb2sgZm9yXG4gICAgLy8gYHRocm93ICc8ZXJyb3IgbWVzc2FnZT4nYCBzb21ld2hlcmUgaW4geW91ciBjb2RlYmFzZS5cbiAgICBlcnJvciA9IG5ldyBTeW50aGV0aWNFcnJvcihlKTtcbiAgfVxuICByZXBvcnRFeGNlcHRpb24oZXJyb3IsIGlzRmF0YWwpO1xufVxuXG5mdW5jdGlvbiByZWFjdENvbnNvbGVFcnJvckhhbmRsZXIoKSB7XG4gIGlmICghY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMpIHtcbiAgICBjb25zb2xlLl9lcnJvck9yaWdpbmFsLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGFyZ3VtZW50c1swXSAmJiBhcmd1bWVudHNbMF0uc3RhY2spIHtcbiAgICAvLyByZXBvcnRFeGNlcHRpb24gd2lsbCBjb25zb2xlLmVycm9yIHRoaXMgd2l0aCBoaWdoIGVub3VnaCBmaWRlbGl0eS5cbiAgICByZXBvcnRFeGNlcHRpb24oYXJndW1lbnRzWzBdLCAvKiBpc0ZhdGFsICovIGZhbHNlKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLl9lcnJvck9yaWdpbmFsLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgY29uc3Qgc3RyaW5naWZ5U2FmZSA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9zdHJpbmdpZnlTYWZlJyk7XG4gICAgY29uc3Qgc3RyID0gQXJyYXkucHJvdG90eXBlLm1hcC5jYWxsKGFyZ3VtZW50cywgc3RyaW5naWZ5U2FmZSkuam9pbignLCAnKTtcbiAgICBpZiAoc3RyLnNsaWNlKDAsIDEwKSA9PT0gJ1wiV2FybmluZzogJykge1xuICAgICAgLy8gUmVhY3Qgd2FybmluZ3MgdXNlIGNvbnNvbGUuZXJyb3Igc28gdGhhdCBhIHN0YWNrIHRyYWNlIGlzIHNob3duLCBidXRcbiAgICAgIC8vIHdlIGRvbid0IChjdXJyZW50bHkpIHdhbnQgdGhlc2UgdG8gc2hvdyBhIHJlZGJveFxuICAgICAgLy8gKE5vdGU6IExvZ2ljIGR1cGxpY2F0ZWQgaW4gcG9seWZpbGxzL2NvbnNvbGUuanMuKVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBlcnJvcjogRXh0ZW5kZWRFcnJvciA9IG5ldyBTeW50aGV0aWNFcnJvcihzdHIpO1xuICAgIGVycm9yLm5hbWUgPSAnY29uc29sZS5lcnJvcic7XG4gICAgZXJyb3IuZnJhbWVzVG9Qb3AgPSAoZXJyb3IuZnJhbWVzVG9Qb3AgfHwgMCkgKyAxO1xuICAgIHJlcG9ydEV4Y2VwdGlvbihlcnJvciwgLyogaXNGYXRhbCAqLyBmYWxzZSk7XG4gIH1cbn1cblxuLyoqXG4gKiBTaG93cyBhIHJlZGJveCB3aXRoIHN0YWNrdHJhY2UgZm9yIGFsbCBjb25zb2xlLmVycm9yIG1lc3NhZ2VzLiAgRGlzYWJsZSBieVxuICogc2V0dGluZyBgY29uc29sZS5yZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnMgPSBmYWxzZTtgIGluIHlvdXIgYXBwLlxuICovXG5mdW5jdGlvbiBpbnN0YWxsQ29uc29sZUVycm9yUmVwb3J0ZXIoKSB7XG4gIC8vIEVuYWJsZSByZXBvcnRFcnJvcnNBc0V4Y2VwdGlvbnNcbiAgaWYgKGNvbnNvbGUuX2Vycm9yT3JpZ2luYWwpIHtcbiAgICByZXR1cm47IC8vIGFscmVhZHkgaW5zdGFsbGVkXG4gIH1cbiAgLy8gRmxvdyBkb2Vzbid0IGxpa2UgaXQgd2hlbiB5b3Ugc2V0IGFyYml0cmFyeSB2YWx1ZXMgb24gYSBnbG9iYWwgb2JqZWN0XG4gIGNvbnNvbGUuX2Vycm9yT3JpZ2luYWwgPSBjb25zb2xlLmVycm9yLmJpbmQoY29uc29sZSk7XG4gIGNvbnNvbGUuZXJyb3IgPSByZWFjdENvbnNvbGVFcnJvckhhbmRsZXI7XG4gIGlmIChjb25zb2xlLnJlcG9ydEVycm9yc0FzRXhjZXB0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gSW5kaXZpZHVhbCBhcHBzIGNhbiBkaXNhYmxlIHRoaXNcbiAgICAvLyBGbG93IGRvZXNuJ3QgbGlrZSBpdCB3aGVuIHlvdSBzZXQgYXJiaXRyYXJ5IHZhbHVlcyBvbiBhIGdsb2JhbCBvYmplY3RcbiAgICBjb25zb2xlLnJlcG9ydEVycm9yc0FzRXhjZXB0aW9ucyA9IHRydWU7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7aGFuZGxlRXhjZXB0aW9uLCBpbnN0YWxsQ29uc29sZUVycm9yUmVwb3J0ZXIsIFN5bnRoZXRpY0Vycm9yfTtcbiJdfQ==